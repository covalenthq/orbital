#!/usr/bin/env ruby
# frozen_string_literal: true

sdk_root = Pathname.new(__FILE__).realpath.parent.parent.expand_path

require 'orbital/context'

ctx = Orbital::Context.create(
  wd: Dir.pwd,
  sdk_root: sdk_root,
  shell_env: ENV
)

Signal.trap('INT') do
  warn("\n#{caller.join("\n")}: interrupted")
  exit(1)
end

begin
  require 'orbital/cli'
  Orbital::CLI.start(ARGV + ['--contextuuid', ctx.uuid.to_s])
rescue Orbital::CommandValidationError => err
  ctx.logger.log_exception(err)
  Kernel.exit(1)
end
